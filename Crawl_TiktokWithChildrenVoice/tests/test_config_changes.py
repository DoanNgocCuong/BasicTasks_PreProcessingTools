#!/usr/bin/env python3
"""
Quick verification script to test the download method configuration changes.
"""

import json
from pathlib import Path

def test_config_changes():
    """Test that configuration changes were applied correctly."""
    print("üß™ Testing Configuration Changes...")
    
    # Test 1: Check crawler_config.json file
    config_file = Path("crawler_config.json")
    if config_file.exists():
        with open(config_file, 'r', encoding='utf-8') as f:
            config_data = json.load(f)
        
        download_method = config_data.get('download_method', 'unknown')
        print(f"‚úÖ crawler_config.json download_method: '{download_method}'")
        
        if download_method == "yt_dlp":
            print("‚úÖ Configuration file correctly uses yt-dlp as default")
        else:
            print(f"‚ùå Expected 'yt_dlp', found '{download_method}'")
    else:
        print("‚ùå crawler_config.json not found")
    
    # Test 2: Check default values in code
    print("\nüîç Checking code defaults...")
    
    try:
        with open("tiktok_video_crawler.py", 'r', encoding='utf-8') as f:
            content = f.read()
        
        # Check dataclass default
        if 'download_method: str = "yt_dlp"' in content:
            print("‚úÖ CrawlerConfig dataclass default: yt_dlp")
        else:
            print("‚ùå CrawlerConfig dataclass still has old default")
        
        # Check config loading default
        if "'download_method', 'yt_dlp'" in content:
            print("‚úÖ Config loading default: yt_dlp")
        else:
            print("‚ùå Config loading still has old default")
        
        # Check default config creation
        if '"download_method": "yt_dlp"' in content:
            print("‚úÖ Default config creation: yt_dlp")
        else:
            print("‚ùå Default config creation still has old value")
            
    except Exception as e:
        print(f"‚ùå Error reading crawler file: {e}")
    
    # Test 3: Check downloader priority changes
    print("\nüîç Checking downloader priority...")
    
    try:
        with open("tiktok_video_downloader.py", 'r', encoding='utf-8') as f:
            content = f.read()
        
        # Check method priority in comments and logs
        if "Method 1: yt-dlp" in content and "Method 2: TikTok API23" in content:
            print("‚úÖ Download method priority: yt-dlp first, API23 fallback")
        else:
            print("‚ùå Download method priority not updated correctly")
            
        # Check docstring
        if "1. yt-dlp (primary method" in content:
            print("‚úÖ Docstring updated with new priority")
        else:
            print("‚ùå Docstring not updated")
            
    except Exception as e:
        print(f"‚ùå Error reading downloader file: {e}")
    
    print("\nüéØ Summary:")
    print("The configuration has been updated to use yt-dlp as the primary download method")
    print("with TikTok API23 as the fallback, instead of the previous order.")

if __name__ == "__main__":
    test_config_changes()